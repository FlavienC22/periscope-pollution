<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Periscope - Pollution de l'air - Urban LAB</title>
    <meta name="description" content="360&deg; Image Gallery - A-Frame">
    <script src="https://aframe.io/releases/0.4.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe-text-component/0.4.2/aframe-text-component.js"></script>
    <script src="https://rawgit.com/squarefeet/ShaderParticleEngine/master/build/SPE.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js'></script>

    <script src='./js/pollution.js'></script>

  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="city" crossorigin="anonymous" src="img/parvis.jpg" >
        <img id="city2" crossorigin="anonymous" src="img/garibaldi1.jpg" >
        <img id="cuisine" crossorigin="anonymous" src="img/360-cottage-interior-render-green.png" >
        <img id="viseur" crossorigin="anonymous" src="./img/viseur-01.png">

        <video id="video" src="./video/test.mp4" autoplay loop crossorigin></video>

      </a-assets>

      <!-- CURSOR -->
      <a-entity position="0 2.2 4">
       <a-entity camera look-controls wasd-controls>
         <a-entity position="0 0 -3"
                   geometry="primitive: ring; radiusOuter: 0.20;
                             radiusInner: 0.10;"
                   material="color: cyan; shader: flat"
                   cursor="maxDistance: 30; fuse: true">
           <a-animation begin="click" easing="ease-in" attribute="scale"
                fill="backwards" from="0.1 0.1 0.1" to="1 1 1" dur="150"></a-animation>
           <a-animation begin="fusing" easing="ease-in" attribute="scale"
                fill="forwards" from="1 1 1" to="0.1 0.1 0.1" dur="1500"></a-animation>
         </a-entity>
       </a-entity>
     </a-entity>

     <a-sphere position="-3 3.25 -1" radius="1.25" color="#EF2D5E" onclick="showSceneRue()"></a-sphere>


      <a-entity id="sceneRue" class="scene">
        <a-sky id="image-360" radius="300" src="#city"></a-sky>
        <a-box position="-2 2 -1" rotation="0 45 0" width="1" height="1" depth="1"  color="#4CC3D9" onclick="showSceneCuisine()"></a-box>
        <a-box position="2 2 -1" rotation="0 45 0" width="1" height="1" depth="1"  color="red" onclick="showVideo()"></a-box>
      </a-entity>

      <!-- 360-degree image. -->
      <a-entity id="sceneCuisine" class="scene" visible="false">
        <a-sky id="image-360" radius="300" src="#cuisine"></a-sky>
        <!-- <a-entity id="pollution" pollution="count:1000;multiplier:0"></a-entity> -->
      </a-entity>

      <a-entity id="sceneVideo" class="scene" visible="false">
        <a-videosphere src="#video" rotation="0 180 0"></a-videosphere>
      </a-entity>


      <script type="text/javascript">

        function hideAllScenes() {
          var scenes = document.getElementsByClassName('scene')
          for(var i = 0; i < scenes.length; i++) {
            scenes[i].setAttribute('visible', 'false')
          }
        }

        function showSceneRue() {
          hideAllScenes() // reset
          document.getElementById("sceneRue").setAttribute('visible', 'true')
        }

        function showVideo() {
          hideAllScenes() // reset
          document.getElementById("sceneVideo").setAttribute('visible', 'true')
        }

        function showSceneCuisine(number) {
          hideAllScenes() // reset
          document.getElementById("sceneCuisine").setAttribute('visible', 'true')

          // var multiplier = 0;
          // var interval = setInterval(function(){
          //   var el = document.getElementById("pollution")
          //   multiplier = multiplier + 0.1;
          //   d3.select("#pollution")
          //     .attr("pollution", function(d){
          //       return { multiplier : multiplier}
          //     })
          //   if(multiplier > 1) clearInterval(interval);
          // }, 300);

        }
      </script>

    </a-scene>
  </body>
</html>
